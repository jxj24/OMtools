% Written by:  Jonathan Jacobs%              March 2017function install_omtools( ~ )% this replicates code from findomtools and setomtools to allow it to be% used even when their locations are not yet known.sep = filesep;% where am I running from?p = mfilename('fullpath');psep = strfind(p,sep);start_dir = p(1:psep(end));cd(matlabroot); cd ..matlabdir = pwd; %#ok<NASGU>omtoolspath = '';%oldpath = pwd;comp = lower( computer('arch') );if strcmp(comp(1),'m') || strcmp(comp(1),'g') % UNIX (Mac & Linux)   homedir = getenv('HOME');   documents = 'documents';   sharedir = '/Users/Shared';elseif strcmp(comp(1),'p')|| strcmp(comp(1),'w') % windows   homedir = getenv('USERPROFILE');   documents = 'My Documents';   sharedir = 'C:\Program Files\Common Files';end% old and new locations OMtools might have been installled.% from here on out, we only install in the user home MATLAB dirlocations = {   {'matlabdir'}; ...   {'matlabroot'}; ...   {'sharedir'}; ...   {'matlabroot', 'toolbox'}; ...   {'homedir', 'documents', 'MATLAB'}; ...   {'homedir', 'documents', 'MATLAB','Add-Ons','toolboxes'}; ...   };omtf=0;								%% # omtools folders foundfor j=1:length(locations)   dir_err=0;   temp=eval( char(locations{j}(1)) );   if ~exist( temp, 'dir')      %disp( ['dir_error: ' locations{j}] );      continue;   end   cd(temp)      % if there are subdirectories, navigate through them.   numsubdir = length(locations{j});   if numsubdir > 1      dir_err=0;      for k=2:numsubdir         temp=char( locations{j}(k) ); %#ok<NASGU>         eval('cd(temp)','dir_err=1;') %#ok<EVLC>      end % for k   end %if numsubdir      if ~dir_err      dirfiles = dir;      for i = 1:length(dirfiles)         temp = deblank(dirfiles(i).name);         if strcmpi( temp, 'omtools')            omtf = omtf+1;            omtoolspath{omtf} = [pwd sep 'OMtools'];         end      end %for i   end %if ~dir_errend %for jif omtf < 1   sorm = '';   disp('No previous OMtools found. I will create a fresh install.')   disp('If you are the only account on this computer that plans to use it')   disp('I will place it inside your personal MATLAB directory')   disp('located in your home directory''s documents folder.')   disp('If other users will want to use it, I will place it in a common area.')   disp('(S)ingle or (M)ultiple users?')   while isempty(strfind('sm',sorm))      sorm = lower(input(' --> ','s'));   end   switch sorm      case 's'         cd(homedir); cd(documents); cd('MATLAB')         home_MLdir = pwd;      case 'm'         cd(sharedir);          if ~exist([sharedir sep 'MATLAB'],'dir')             mkdir('MATLAB')         end         cd('MATLAB')         home_MLdir = pwd;      otherwise   end   elseif omtf >= 1   disp('Existing OMtools folders found:')   for m = 1:omtf      disp([num2str(m) ': ' char(omtoolspath{m}) ] )   end   %temp = char(omtoolspath{omtf});      % find the omprefs and ztprefs folders, copy to a safe location   % cheat and assume in-use OMtools location using 'which'   cd(homedir); cd(documents); cd('MATLAB')   home_MLdir = pwd;   disp(' ')   disp('Backing up OMtools prefs and zoomtool prefs if they exist.')   disp('They will be copied to the MATLAB folder in your home documents dir.')   if ~exist('omtools_prefs','dir')      mkdir('omtools_prefs'); cd('omtools_prefs')      mkdir('omprefs');mkdir('ztprefs')   else      cd('omtools_prefs')   end   zt_temp = which('zoomtool.m','-all');   if ~isempty(zt_temp)      if length(zt_temp) > 1         disp('Multiple zoomtool pref folders found');         disp('I am confused.')      else         zt_temp=char(zt_temp);         zsep = strfind(zt_temp,sep);         ztp_loc = [zt_temp(1:zsep(end)) 'ztprefs'];         if exist(ztp_loc,'dir')            copyfile( ztp_loc, 'ztprefs')         else            mkdir('ztprefs')         end      end   end      op_temp = which('rd.m','-all');   if ~isempty(op_temp)      if length(op_temp) > 1         disp('Multiple OMtools pref folders found');         disp('I am confused.')      else         op_temp=char(op_temp);         opsep = strfind(op_temp,sep);         op_loc = [op_temp(1:opsep(end-1)) 'omprefs'];         if exist(op_loc,'dir')            copyfile( op_loc, 'omprefs')         else            mkdir('omprefs')         end      end            % personal directory      per_loc = [op_temp(1:opsep(end-1)) 'personal'];      if exist(per_loc,'dir')         copyfile( per_loc, 'personal')      else         mkdir('personal')      end   end      disp(' ')   disp('I recommend you inactivate the other installations.')   disp('I won''t delete them, just change the name to OM_X_tools.')   disp('Do you want to do this?  (y/n)')   yorn=input('--> ','s');   if strcmpi(yorn,'y')      for m=1:omtf         % rename the other omtools folders         a = strfind(omtoolspath{m}, 'OMtools');         b = [ omtoolspath{m}(1:a-1) 'OM_x_' omtoolspath{m}(a+2:end) ];         movefile(omtoolspath{m}, b);      end %for   end % if strcmpend %if omtf% now for the installation.% what is the new OMtools folder? Is it a simple folder or is it a toolbox file?cd(start_dir)temp = dir; pkg_found = 0; dir_found = 0; s_or_p='';for i=1:length(temp)   if strcmp(temp(i).name, 'OMtools') && temp(i).isdir      dir_found = 1; s_or_p = 's';   end   if strcmp(temp(i).name, 'OMtools.mltbx') && ~temp(i).isdir      pkg_found = 1; s_or_p = 'p';   endendif pkg_found && dir_found   disp(' ')   disp('Do you want to install the (p)re-packaged MATLAB toolbox version')   disp('or the (s)tand-alone version? Both have the same functionality,')   disp('but the pre-packaged version will automatically add all the needed')   disp('MATLAB paths. (s/p)')   s_or_p = 'x';   while ~( strcmp(s_or_p,'s') || strcmp(s_or_p,'p') )      s_or_p = lower(input('--> ','s'));   endendcd(home_MLdir)switch s_or_p   case 's'      mkdir('OMtools')      copyfile([start_dir 'OMtools'], 'OMtools')      disp(['Stand-alone version installed to ' home_MLdir sep 'MATLAB' sep 'OMtools'])   case 'p'      open( [start_dir 'OMtools.mltbx'] )      disp(['Pre-packaged version installed to ' home_MLdir sep 'MATLAB' sep 'Add-ons'])   otherwise      disp('I have no idea what happened. Nothing has been installed.')      returnend% startup.m file(s) exist?% is there one in toolboxes/local?cd(matlabroot);cd('toolbox');cd('local')if ~isempty( dir('startup.m') )   disp('There is a startup.m file in MATLAB''s "toolbox/local" directory.')   disp('You should remove it if it is an old OMtools file.')   ! open .   disp('')endstartupfiles = which( 'startup.m' );if isempty(startupfiles)   disp('There is no startup.m file in your home MATLAB directory.')   disp('If you want to create one, add the line "omstart" and save.')   disp('Would you like me to try this now (y/n)?')   yorn=input('  -> ','s');   if strcmpi(yorn,'y')      cd(home_MLdir)      fid=fopen('startup.m','w+');      fwrite(fid,['omstart' char(13)]);      fclose(fid);   end   disp('')elseif strfind(startupfiles,home_MLdir)   disp('There is a startup.m file in your home MATLAB directory.')   disp('If you wish, add a line "omstart" (without the quotes) and save.')   disp('Would you like me to try this now (y/n)?')   yorn=input('  -> ','s');   if strcmpi(yorn,'y')      cd(ML_dir)      fid=fopen('startup.m','a');      fwrite(fid,['omstart' char(13)]);      fclose(fid);   endenddisp('To verify that OMtools is working, I will run "omstart" at the MATLAB command line.')cd([home_MLdir sep 'OMtools' sep 'omtoolsdirs'])omstartcd(matlabroot)