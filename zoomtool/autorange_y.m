% autorange_y.m: set the y-axis limits to fit all lines% written by: Jonathan Jacobs%             March 1997 - September 1999 (last mod: 09/02/99)function autorange_y(ga)if nargin == 0   ga = gca;endtemp = ga.UserData;if length(temp)<3   gf = ga.Parent;   lhand = get(findpush(gf,'T'),'UserData');else   lhand = temp{3};end%handleList = ga.UserData;%handleList = temp{1};autoRange = get(temp{2}{23}, 'Value');if ~autoRange   returnendxfactor = get( get(ga,'XLabel'),'UserData' );xlims = ga.XLim ./ xfactor;ymin =  1000000000*ones(size(lhand));ymax = -1000000000*ones(size(lhand));for i = 1:length(lhand)   if ~ishandle(lhand(i)), break; end   y = lhand(i).YData;   x = lhand(i).XData ./ xfactor;   isVis = strcmp(lhand(i).Visible,'on');   found = find( (x >= xlims(1)) & (x<=xlims(2)) );   if length(found) >= 2 && isVis      xlo = max(1, found(1));      xhi = found(length(found));      % check the non_NaN y values for a maximum.      % (the "+xlo-1" is to keep the indices correct)      goodPts = find(~isnan(y(xlo:xhi)));      if ~isempty(goodPts)         ymin(i) = min( y(goodPts+xlo-1) );          ymax(i) = max( y(goodPts+xlo-1) );       end    else      ymin(i) =  1000000000;      ymax(i) = -1000000000;   endend%keyboard ylim = [min(ymin) max(ymax)];delta = (ylim(2) - ylim(1)) * 0.05;if delta == 0   delta = ylim(1)*0.25;endylim(1) = ylim(1) - delta;ylim(2) = ylim(2) + delta;if ylim(1) ~= ylim(2)  if ylim(1) > ylim(2)    temp = ylim(1);    ylim(1) = ylim(2);    ylim(2) = temp;  end    ga.YLim=ylim;endnewlims%keyboard