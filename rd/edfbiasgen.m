% edfbiasgen.m: generate an adjust bias file for data converted from EDF files.% Written by:  Jonathan Jacobs% December 2016 - July 2018 (last mod: 24 July 2018)%% edit by Peggy Skelly 07/03/17: line 75 changed so that% underscore & number are added to the bin file name%% now handles EDF records with multiple sub-records that have% different channels (e.g. rec1=rh,rv; rec2=lh,lv; rec3=rh,lh,rv,lvfunction edfbiasgen(fname,pn,sf,numrecs,chans,stsv)if ~exist('stsv','var'),stsv=0;endbiasfile = ['adjbias_' fname '.txt'];cd(pn)afilelist=dir('adjbias_*');for i=1:length(afilelist)   if strcmpi( afilelist(i).name, biasfile )      disp( ['** The file ' biasfile ' already exists.'])      disp(  '** Do you want to replace it (y/n)?')      commandwindow      yorn=input('** -> ','s');      if strcmpi(yorn,'y')         delete(biasfile)         disp(['** ' biasfile ' will be replaced.'])         disp(' ')         break      else         return      end   endend[comp, ~] = computer;if strcmp( comp(1),'M' )   CR = 13;else   CR = [13 10];endCR = char(CR);oldpath = pwd;mstr = 'VID'; exten = '.bin'; %format = 'B';fstr = 'RAWBIN'; orgstr = 'Contiguous';%h_adjstr = '  0   [15 20 25 30] 1 1 1 1  [-15 -20 -25 -30] 1 1 1 1';adjstr = '  0   [10]  1  [-10]  1';sampfstr = num2str(sf(1));%chop off any trailing underscore for now. We will add it back when needed%stripped_uscore = 0;subjstr=fname;if subjstr(length(subjstr))=='_'   subjstr = subjstr(1:end-1);   %stripped_uscore = 1;endfid = fopen(['adjbias_' fname,'.txt'],'wt');if fid == -1, disp('Yikes! Could not create that file!'); keyboard; enda = exist('time','file');if a == 2   dstr = [' on ' time('d',1,24,1)];   tstr = [' at ' time('t',1,24,1)];else   dstr = '';   tstr = '';endcommentstr1 = '% automagically generated by "biasgen"';commentstr2 = ['%' dstr tstr];fwrite(fid, [commentstr1 CR]);fwrite(fid, [commentstr2 CR]);fwrite(fid, CR);% now we can add the underscore back if needed.% subjstr = the edf recorded file name. So if the file was named with a% number at the end, an additional _1 is added, which is not what we want,% but I'm not sure how to fix it.% change so that any time there is more than 1 record,% there will be an underscore and number added% if (isdigit(subjstr(end)) || stripped_uscore == 1)  &&  numrecs>1if numrecs>1   add_num = 1;else   add_num = 0;endfor i = 1:numrecs   chan_count=length(chans{i});   if add_num      temp = [subjstr '_' num2str(i)];   else      temp = subjstr;   end   firstline = [temp  exten '  ' num2str(chan_count) '  '...      mstr '  ' fstr ' ' sampfstr ' ' orgstr  CR];   fwrite(fid,firstline);   for j = 1:chan_count      if stsv==1         chans{i}{end+1}='st';         chans{i}{end+1}='sv';      end      nextline = [chans{i}{j} '  ' adjstr CR];  % used to place 'sampfstr' here.      %nextline = [chanstr(j,1:2) '  ' adjstr CR];  % used to place 'sampfstr' here.      fwrite(fid, nextline);   end   fwrite(fid, CR);endfclose(fid);disp(['Adjust bias file written as ' biasfile]);disp('P.S.: Don''t panic if you think you messed up.')disp('You can manually edit the bias file using any text editor,')disp('so you can tweak any values afterwards.')disp(' ')try   cd(oldpath)catchend